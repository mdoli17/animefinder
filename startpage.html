<html>
    <style>
        .searchfield 
        {
            text-align: center;
        }

        .input 
        {
            border-radius: 3ch;
            border-style:solid;
            width: 50%;
            height: 5%;
            text-align: center;
            font-size: 2ch;
        }

        ::-webkit-input-placeholder
        {
            text-align: center;
            font-size: 125%;
        }
        
        body {
            background: url(background.jpg) no-repeat center center fixed;
        }

        .testimages 
        {
            width: 10%;
            display: inline-block;
            margin-right: 2%;
        }

        #characterimages
        {
            overflow-x: scroll;
            overflow-y: hidden;
            white-space: nowrap;
            display: flex;
            justify-content: center;
        }

        #characterimages ::-webkit-scrollbar {
            display: none;
        }

    </style>


    <head>
        <title>Find your character</title>
    </head>
    
    <body>
        <script>
            const HomeURL = "https://ghibliapi.herokuapp.com/people";
            
            var characterAttributes;
            
            function constructor()
            {
                characterAttributes = new CharacterAttributes();
            }
            
            window.onload = constructor();

            function CharacterAttributes()
            {
                this.name = null;
                this.age = null;
                this.eyecolor = null;
                this.haircolor = null;
                this.specie = null;
                this.gender = null;
            }


            /*
                Called when user enters something in search field
                Should get the input and call a parser for it
                Clear the search field
            */
            function onSearchEntered()
            {
                var input = document.getElementById("userinput").value;
                document.getElementById("userinput").value = "";
                parseInput(input);
            }   

            /*
                Should parse the given text
                Text can be given in any format
                
                Successful parsing cases:
                    The last word is a Character attribute and the words before are adjactives
                    Number + "Years old"
                    Specie type e.g: "God", "Human", "Cat" ... 
                    Gender
                    Name
                
                Fill in CharacterAttributes struct with given parsed input
            */
            function parseInput(text) 
            {
                var words = text.split(" ");

                var last = words[words.length - 1].toLowerCase();
                
                if(last == "eyes")
                {
                    var eyecolor = words[0];
                    characterAttributes.eyecolor = eyecolor;
                    console.log("The user is trying to add an EYE attribute");
                }
                if(last == "hair")
                {
                    console.log("The user is trying to add an HAIR attribute");
                }      
            }

            /*
                Gets JSON data according to the CharacterAttributes
            */
            function onFindPressed() 
            {
                var data = getJSONData();
                var newData = [];
                data.then((value) => {
                    value.forEach(element => {
                        if(element.eye_color == characterAttributes.eyecolor)
                        {
                            newData.push(element);
                        }    
                    });
                    updateUI(newData);
                });

            }


            // Updates the Scrollable Div with Data
            function updateUI(dataArray)
            {
                document.getElementById("characterimages").textContent = " ";
                
                var count = dataArray.length;
                for(var i = 0; i < count; i++)
                {
                    var imgelem = document.createElement("img");
                    imgelem.setAttribute("src", "testimage.png");
                    imgelem.setAttribute("class", "testimages");
                    document.getElementById("characterimages").appendChild(imgelem);
                }
            }


            async function getJSONData()
            {
                const response = await fetch(HomeURL, {mode: "cors"});
                const data = await response.json();
                return data;
            }
            // async function getCharacter(eyecolour, haircolour, gender, age) {
            //     const response = await fetch(HomeURL, {mode: "cors"});
            //     const data = await response.json();
                
            //     data.forEach(element => {
            //         if(element.eye_color == eyecolour && element.hair_color == haircolour && element.gender == gender) 
            //         {
            //             console.log(element.name);   
            //         }
            //     });  
            // }

            // async function getData() 
            // {
            //     const response = await fetch(HomeURL, {mode: "cors"});
            //     const data = await response.json();

            //     return data;
            // }

            // async function getCount()
            // {
            //     const response = await fetch(HomeURL, {mode: "cors"});
            //     const data = await response.json();
                
            //     return data.length;
            // }

            // function parseInput(input) 
            // {
            //     var res = input.split(" ");
                
            //     if(Object.values(Colors).includes("Red"))
            //     {
            //         console.log(res[0]);
            //         return res[0];
            //     }
            //     console.log("dddd");
            //     return "ASDASD ";
            // }

            // function onSearchEntered() 
            // {
            //     document.getElementById("characterimages").textContent = " ";
            //     var data = getData();
            //     data.then((value) => {
            //         var count = value.length;
            //         for(var i = 0; i < count; i++)
            //         {
            //             var imgelem = document.createElement("img");
            //             imgelem.setAttribute("src", "testimage.png");
            //             imgelem.setAttribute("class", "testimages");
            //             document.getElementById("characterimages").appendChild(imgelem);
            //         }
            //     });
            // }


            // function onFindPressed() {
            //     console.log("AE");
            // }

            // function onDropChanged() {
            //     var eyecolour = document.getElementById("eyecolour").value;
            //     var haircolour = document.getElementById("haircolour").value;
            //     var gender = document.getElementById("gender").value;
            //     var age = document.getElementById("age").value;

            //     getCharacter(eyecolour, haircolour, gender, age);
            // }




        </script>

        <div class="searchfield">
            <input class="input" type="text" placeholder="Enter character traits" id="userinput" onchange="onSearchEntered()">

            <form>
                <label for="eyecolour">Eye Colour: </label>
                <select name="eyecolour" id="eyecolour" onchange="onDropChanged()">
                    <option value="Red">Red</option>
                    <option value="Blue">Blue</option>
                    <option value="Green">Green</option>
                    <option value="Grey">Grey</option>
                    <option value="Black">Black</option>
                    <option value="Dark Brown">Dark Brown</option>
                    <option value="Brown">Brown</option>
                </select>

                <label for="hairColour">Hair Colour: </label>
                <select name="hairColour" id="haircolour" onchange="onDropChanged()">
                    <option value="Red">Red</option>
                    <option value="Blue">Blue</option>
                    <option value="Green">Green</option>
                    <option value="Grey">Grey</option>
                    <option value="Black">Black</option>
                    <option value="Dark Brown">Dark Brown</option>
                    <option value="Brown">Brown</option>
                </select>

                <label for="gender">Gender: </label>
                <select name="gender" id="gender" onchange="onDropChanged()">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
                
                <label for="age">Age: </label>
                <input id="age" type="number" min="1" max="100">
                
            </form>
            <button onclick="onFindPressed()">Find</button>
        </div>

        <div id="characterimages">
            
        </div>
    </body>
</html>